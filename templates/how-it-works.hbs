<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>how-it-works</title>
    <link href="css/main-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/main-header-footer-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/how-it-works-styles.css" rel="stylesheet" type="text/css" />
</head>

<body class="HIW-body">
    {{> header }}
    {{> mobileHeader}}

    <main class="content-section">
        <div class="inner-content-section">
            <!-- React will mount here -->
            <div id="react-steps-container">
                <div style="padding: 2rem; text-align: center; color: #4379ba;">
                    <h2>Loading React Component...</h2>
                    <p>If you see this message, React hasn't loaded yet.</p>
                </div>
            </div>
        </div>
    </main>

    <section> <!-- Wave -->
        <div>
            <div class="wave-pattern">
                {{> svg/wavePattern6}}
            </div>
        </div>
    </section>

    {{> footer}}

    <!-- Load React from CDN that's allowed by CSP -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    
    <!-- How It Works - React scroll section -->
    <script>
        console.log('Script starting...');
        console.log('React available:', typeof React !== 'undefined');
        console.log('ReactDOM available:', typeof ReactDOM !== 'undefined');
        
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing React component...');
            
            const { useState, useEffect, useRef, createElement: h } = React;

            function VerticalStepsNavigation() {
                const [activeStep, setActiveStep] = useState(0);
                const [visibleSteps, setVisibleSteps] = useState(new Set([0]));
                const containerRef = useRef(null);
                const stepRefs = useRef([]);

                const steps = [
                    {
                        number: "01",
                        title: "Set up an account for free",
                        description: "Hit the 'Sign Up' button to get started."
                    },
                    {
                        number: "02",
                        title: "Import your health data",
                        description: "Upload your health information from labs and/or document scans."
                    },
                    {
                        number: "03",
                        title: "Use our dashboards and reports",
                        description: "Our reports make complex health information easy to understand. We set it up so that it provides feedback and actionable insights that is unique to you."
                    },
                    {
                        number: "04",
                        title: "Use our share feature (Optional)",
                        description: "Share your profile or specific results with your doctor to discuss issues and put together an action plan."
                    }
                ];

                useEffect(() => {
                    console.log('Setting up intersection observer...');
                    const observer = new IntersectionObserver(
                        (entries) => {
                            entries.forEach((entry) => {
                                const stepIndex = parseInt(entry.target.dataset.stepIndex);
                                
                                if (entry.isIntersecting) {
                                    setVisibleSteps(prev => new Set([...prev, stepIndex]));
                                    setActiveStep(stepIndex);
                                }
                            });
                        },
                        {
                            threshold: 0.6,
                            rootMargin: '-20% 0px -20% 0px'
                        }
                    );

                    stepRefs.current.forEach((ref) => {
                        if (ref) observer.observe(ref);
                    });

                    return () => observer.disconnect();
                }, []);

                const scrollToStep = (index) => {
                    stepRefs.current[index]?.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                };

                // Create the component structure using React.createElement
                return h('div', {
                    className: 'react-steps-container'
                }, 
                    h('div', {
                        className: 'react-steps-wrapper'
                    }, [
                        // Header
                        h('div', {
                            key: 'header',
                            className: 'react-steps-header'
                        }, [
                            h('h1', {
                                key: 'title',
                                className: 'react-steps-title'
                            }, 'How it works'),
                            h('p', {
                                key: 'subtitle',
                                className: 'react-steps-subtitle'
                            }, 'Take control of your health data with our simple four-step process')
                        ]),
                        
                        // Steps Container
                        h('div', {
                            key: 'steps-container',
                            ref: containerRef,
                            className: 'react-steps-timeline-container'
                        }, [
                            // Progress Line
                            h('div', {
                                key: 'progress-line',
                                className: 'react-steps-progress-line'
                            }),
                            
                            // Active Progress Line
                            h('div', {
                                key: 'active-progress-line',
                                className: 'react-steps-active-progress',
                                style: {
                                    height: `${((activeStep + 1) / steps.length) * 100}%`
                                }
                            }),

                            // Steps
                            ...steps.map((step, index) => 
                                h('div', {
                                    key: `step-${index}`,
                                    ref: (el) => stepRefs.current[index] = el,
                                    'data-step-index': index,
                                    className: `react-step-block ${visibleSteps.has(index) ? 'visible' : ''}`,
                                    onClick: () => scrollToStep(index)
                                }, [
                                    // Step Number
                                    h('div', {
                                        key: 'step-number',
                                        className: `react-step-number ${visibleSteps.has(index) ? 'active' : ''}`
                                    }, [
                                        step.number,
                                        activeStep === index && h('div', {
                                            key: 'pulse',
                                            className: 'react-step-pulse'
                                        })
                                    ]),

                                    // Step Content Card
                                    h('div', {
                                        key: 'step-card',
                                        className: `react-step-card ${visibleSteps.has(index) ? 'visible' : ''}`
                                    }, [
                                        h('h3', {
                                            key: 'step-title',
                                            className: 'react-step-card-title'
                                        }, step.title),
                                        h('p', {
                                            key: 'step-description',
                                            className: 'react-step-card-description'
                                        }, step.description)
                                    ])
                                ])
                            )
                        ]),

                        // Navigation Dots
                        h('div', {
                            key: 'navigation-dots',
                            className: 'react-steps-navigation'
                        }, steps.map((_, index) => 
                            h('button', {
                                key: `dot-${index}`,
                                onClick: () => scrollToStep(index),
                                className: `react-steps-nav-dot ${activeStep === index ? 'active' : ''}`
                            })
                        ))
                    ])
                );
            }

            // Mount the component
            try {
                const container = document.getElementById('react-steps-container');
                if (container) {
                    console.log('Container found, creating root...');
                    const root = ReactDOM.createRoot(container);
                    console.log('Root created, rendering component...');
                    root.render(React.createElement(VerticalStepsNavigation));
                    console.log('Component rendered successfully!');
                } else {
                    console.error('Container element not found!');
                }
            } catch (error) {
                console.error('Error mounting React component:', error);
            }
        });
    </script>

    <script src="js/main.js" defer type="module"></script>
    <script src="js/main-mobile.js" defer type="module"></script>
</body>

</html>