<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Welcome</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="css/main-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/user-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/user-header-footer-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/welcome-styles.css" rel="stylesheet" type="text/css" />
    {{!-- <script src="https://unpkg.com/lucide@latest"></script> --}}
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>

  <body class="user-body">
    {{> mobileUserHeader}}

    <div class="sidebar">
      <div class="sidebar-logo-wrapper">
        <div class="sidebar-logo-link">
          <img
            src="images/logo2.png"
            loading="lazy"
            alt="Logo"
            class="sidebar-logo"
        /></div>
      </div>
      <div class="nav-divider-basics nav-divider-top"></div>
      <a id="Profile" href="/profile" class="page-link w-inline-block">
        <img loading="lazy" src="images/user.svg" alt="Icon" class="nav-icon" />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Profile</span>
        </div>
      </a>
      <a id="Upload" href="/upload" class="page-link w-inline-block">
        <img
          src="images/file-text.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Upload</span>
        </div>
      </a>
      <a
        id="Reports"
        href="/reports"
        aria-current="page"
        class="page-link w-inline-block"
        ><img
          src="images/clipboard.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Reports</span>
        </div>
      </a>
      <a
        id="Insights"
        href="/insights"
        class="page-link w-inline-block"
      >
        <img
          src="images/layout.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Insights</span>
        </div>
      </a>
      <a
        id="Chatbot"
        href="/chatbot"
        class="page-link w-inline-block"
      >
        <img
          src="images/chatbot.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Ask</span>
        </div>
      </a>
      <div class="nav-divider-basics nav-divider-bottom"></div>
      <a id="Log-out" href="/logout" class="page-link w-inline-block" onclick="return confirmLogout(event)">
        <img
          src="images/unlock.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Log out</span>
        </div>
      </a>
      <div class="sidebar-bottom-spacer"></div>
    </div>

    <!-- Highlight elements - Original plus new group highlights -->
    <div class="highlight-nav" id="highlightProfile"></div>
    <div class="highlight-nav" id="highlightUpload"></div>
    <div class="highlight-nav" id="highlightReports"></div>
    <div class="highlight-nav" id="highlightInsights"></div>
    <div class="highlight-nav" id="highlightChatbot"></div>
    <div class="highlight-nav" id="highlightInputGroup"></div>
    <div class="highlight-nav" id="highlightOutputGroup"></div>

    <div class="dashboard-content">
      <!-- Welcome card -->
      <div class="welcome-card" id="welcomeCard">
        <div class="welcome-header">
          <h1 class="welcome-title">Welcome to HealthLync</h1>
          <p class="welcome-subtitle">
            Click below for a quick tutorial
          </p>
          <div class="welcome-buttons">
            <button class="get-started-btn" id="getStartedBtn">
              Get Started
            </button>
            <button class="skip-tutorial-btn" id="skipTutorialBtn">
              Skip Tutorial
            </button>
          </div>
        </div>

        <div class="feature-overview">
          <div class="feature-item" data-target="Profile">
            <div class="feature-icon"><i data-lucide="user-circle" style="width: 48px; height: 48px; stroke-width: 1.5;"></i></div>
            <div class="feature-title">Profile</div>
            <div class="feature-description">
              Add your personal health details and medical history
            </div>
          </div>
          <div class="feature-item" data-target="Upload">
            <div class="feature-icon"> <i data-lucide="file-up" style="width: 48px; height: 48px; stroke-width: 1.5;"></i></div>
            <div class="feature-title">Upload</div>
            <div class="feature-description">
              Upload your medical records and lab results
            </div>
          </div>
          <div class="feature-item" data-target="Reports">
            <div class="feature-icon"><i data-lucide="bar-chart-3" style="width: 48px; height: 48px; stroke-width: 1.5;"></i></div>
            <div class="feature-title">Reports</div>
            <div class="feature-description">
              View detailed reports based on your health data
            </div>
          </div>
          <div class="feature-item" data-target="Insights">
            <div class="feature-icon"><i data-lucide="lightbulb" style="width: 48px; height: 48px; stroke-width: 1.5;"></i></div>
            <div class="feature-title">Insights</div>
            <div class="feature-description">
              Get personalized insights and recommendations
            </div>
          </div>
          <div class="feature-item" data-target="Chatbot">
            <div class="feature-icon"><i data-lucide="message-circle" style="width: 48px; height: 48px; stroke-width: 1.5;"></i></div>
            <div class="feature-title">Chatbot</div>
            <div class="feature-description">
              Ask questions to our AI Chatbot Reed
            </div>
          </div>
        </div>
      </div>

      <!-- Interactive steps -->
      <div class="steps-container2">
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- NEW Step 1: Input Pages Overview -->
        <div class="step-container" id="stepInputOverview">
          <div class="step-content">
            <div class="step-title">
              {{!-- <span class="welcome-step-number"></span> --}}
              Input Pages
            </div>
            <div class="step-description">
              <div class="highlight">
                Input your information in the <strong>Profile</strong> and <strong>Upload</strong> pages.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="stepInputOverviewNext">Next</button>
              <button class="button-skip" id="skipTutorialInputOverview">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- NEW Step 2: Output Pages Overview -->
        <div class="step-container" id="stepOutputOverview">
          <div class="step-content">
            <div class="step-title">
              {{!-- <span class="welcome-step-number"></span> --}}
              Output Pages
            </div>
            <div class="step-description">
              <div class="highlight">
                The output pages includes the <strong>Reports</strong>, <strong>Insights</strong>, and <strong>Ask</strong> pages.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="stepOutputOverviewNext">Next</button>
              <button class="button-skip" id="skipTutorialOutputOverview">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- UPDATED Step 3 (was Step 1): Build a Profile -->
        <div class="step-container" id="step1">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">1</span>
              Build a Profile
            </div>
            <div class="step-description">
              <div class="highlight">
                The <strong>Profile</strong> page is where you enter  your
                personal information, family medical history, lifestyle
                details and more.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step1Next">Next</button>
              <button class="button-skip" id="skipTutorial">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- UPDATED Step 4 (was Step 2): Upload Files -->
        <div class="step-container" id="step2">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">2</span>
              Upload Files
            </div>
            <div class="step-description">
              <div class="highlight">
                The <strong>Upload</strong> page is you can upload lab results and any other health documents to further build your health profile.
              </div>
              We'll automatically extract key information.
            </div>
            <div class="actions">
              <button class="button-next" id="step2Next">Next</button>
              <button class="button-skip" id="skipTutorial2">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- UPDATED Step 5 (was Step 3): Detailed Reports -->
        <div class="step-container" id="step3">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">3</span>
              Detailed Reports
            </div>
            <div class="step-description">
              We create comprehensive reports from your uploaded files
              <div class="highlight">
                The <strong>Reports</strong> page gives you a more detailed analysis
                of your biomarkers, trends over time, and comparisons to
                reference ranges
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step3Next">Next</button>
              <button class="button-skip" id="skipTutorial3">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- UPDATED Step 6 (was Step 4): Actionable Takeaways -->
        <div class="step-container" id="step4">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">4</span>
              Actionable Insights
            </div>
            <div class="step-description">
              Here we have personalized insights and recommendations based on your data
              <div class="highlight">
                Our <strong>Insights</strong> page is built on a combination of your data plus our innovative "early-health" database built by experts
              </div>
              Let us connect the dots for you
            </div>
            <div class="actions">
              <button class="button-next" id="step4Next">Next</button>
              <button class="button-skip" id="skipTutorial4">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- UPDATED Step 7 (was Step 5): Ask our AI Chatbot -->
        <div class="step-container" id="step5">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">5</span>
              Ask our AI Chatbot anything
            </div>
            <div class="step-description">
              Ask Reed health specific questions that are unique to you
              <div class="highlight">
                Our chatbot uses your input data, insights and our unique database to give you the best answers possible
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step5Next">Let's Start!</button>
              <button class="button-skip" id="skipTutorial5">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/main-user.js" defer type="module"></script>
    <script src="js/mobile-logout.js"></script>
    <script src="js/sidebar-logout.js"></script>
    <script> // Welcome animations
      document.addEventListener("DOMContentLoaded", () => {
        console.log('Welcome page script loading...');
        
        // TUTORIAL FUNCTIONALITY
        const getStartedBtn = document.getElementById("getStartedBtn");
        const welcomeCard = document.getElementById("welcomeCard");
        const stepsContainer = document.querySelector(".steps-container2");
        const progressBar = document.getElementById("progressBar");
        const skipButtons = document.querySelectorAll(".button-skip");

        // Navigation elements - check for both desktop and mobile versions
        const profileLink = document.getElementById("Profile") || document.getElementById("Profile-mobile");
        const uploadLink = document.getElementById("Upload") || document.getElementById("Upload-mobile");
        const reportsLink = document.getElementById("Reports") || document.getElementById("Reports-mobile");
        const insightsLink = document.getElementById("Insights") || document.getElementById("Insights-mobile");
        const chatbotLink = document.getElementById("Chatbot") || document.getElementById("Chatbot-mobile");

        // Highlight elements - Original plus new group highlights
        const highlightProfile = document.getElementById("highlightProfile");
        const highlightUpload = document.getElementById("highlightUpload");
        const highlightReports = document.getElementById("highlightReports");
        const highlightInsights = document.getElementById("highlightInsights");
        const highlightChatbot = document.getElementById("highlightChatbot");
        const highlightInputGroup = document.getElementById("highlightInputGroup");
        const highlightOutputGroup = document.getElementById("highlightOutputGroup");

        // Arrow elements (kept from original)
        const arrowToProfile = document.getElementById("arrowToProfile");
        const arrowToUpload = document.getElementById("arrowToUpload");
        const arrowToReports = document.getElementById("arrowToReports");
        const arrowToInsights = document.getElementById("arrowToInsights");
        const arrowToChatbot = document.getElementById("arrowToChatbot");

        // Step elements - Original plus new overview steps
        const stepInputOverview = document.getElementById("stepInputOverview");
        const stepOutputOverview = document.getElementById("stepOutputOverview");
        const step1 = document.getElementById("step1");
        const step2 = document.getElementById("step2");
        const step3 = document.getElementById("step3");
        const step4 = document.getElementById("step4");
        const step5 = document.getElementById("step5");

        // Next buttons - Original plus new overview buttons
        const stepInputOverviewNext = document.getElementById("stepInputOverviewNext");
        const stepOutputOverviewNext = document.getElementById("stepOutputOverviewNext");
        const step1Next = document.getElementById("step1Next");
        const step2Next = document.getElementById("step2Next");
        const step3Next = document.getElementById("step3Next");
        const step4Next = document.getElementById("step4Next");
        const step5Next = document.getElementById("step5Next");

        // Current step tracker - UPDATED total steps
        let currentStep = 0;
        const totalSteps = 7;
        let tutorialActive = false;

        console.log('Tutorial elements found:', {
          getStartedBtn: !!getStartedBtn,
          welcomeCard: !!welcomeCard,
          stepsContainer: !!stepsContainer,
          profileLink: !!profileLink,
          highlightProfile: !!highlightProfile,
          highlightInputGroup: !!highlightInputGroup,
          highlightOutputGroup: !!highlightOutputGroup,
          arrowToProfile: !!arrowToProfile
        });

        function ensureMobileMenuOpen() {
          if (window.innerWidth <= 768 && tutorialActive) {
            const mobileMenu = document.querySelector('.mobile-menu');
            const hamburgerButton = document.getElementById('hamburger-button');
            
            if (mobileMenu && hamburgerButton) {
              // Force menu open
              hamburgerButton.classList.add('open');
              mobileMenu.classList.add('open');
              
              // Prevent content push-down
              document.body.classList.remove('menu-open');
              
              // Style for tutorial
              mobileMenu.style.position = 'absolute';
              mobileMenu.style.zIndex = '1600';
              mobileMenu.style.maxHeight = '140px'; // Match your CSS
              mobileMenu.style.opacity = '1';
              mobileMenu.style.visibility = 'visible';
              mobileMenu.style.display = 'grid'; // Match your mobile menu display
            }
          }
        }

        // NEW: Function to highlight multiple navigation items
        function highlightMultipleNavItems(navItems, highlightEl, color = 'green') {
          if (!highlightEl || !navItems || navItems.length === 0) return;

          // Get bounding rectangles of all nav items
          const rects = navItems.map(item => item.getBoundingClientRect());
          
          if (rects.length === 0) return;

          // Calculate combined bounding box
          const minLeft = Math.min(...rects.map(r => r.left));
          const maxRight = Math.max(...rects.map(r => r.right));
          const minTop = Math.min(...rects.map(r => r.top));
          const maxBottom = Math.max(...rects.map(r => r.bottom));

          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

          // Position relative to document
          highlightEl.style.position = 'absolute';
          highlightEl.style.top = `${minTop + scrollTop - 5}px`;
          highlightEl.style.left = `${minLeft + scrollLeft - 5}px`;
          highlightEl.style.width = `${maxRight - minLeft + 10}px`;
          highlightEl.style.height = `${maxBottom - minTop + 10}px`;
          
          // Set color based on type
          if (color === 'blue') {
            highlightEl.style.backgroundColor = 'rgba(63, 177, 241, 0.2)';
            highlightEl.style.borderColor = '#3fb1f1';
          } else {
            // Default green
            highlightEl.style.backgroundColor = 'rgba(92, 177, 93, 0.2)';
            highlightEl.style.borderColor = '#5cb15d';
          }
          
          // Show the highlight
          highlightEl.classList.add('show');
        }

        // Initialize features hover synchronization
        function initializeFeatureHover() {
          const featureItems = document.querySelectorAll(".feature-item");
          
          // Get all navigation links (both desktop and mobile)
          const allProfileLinks = document.querySelectorAll("#Profile, #Profile-mobile");
          const allUploadLinks = document.querySelectorAll("#Upload, #Upload-mobile");
          const allReportsLinks = document.querySelectorAll("#Reports, #Reports-mobile");
          const allInsightsLinks = document.querySelectorAll("#Insights, #Insights-mobile");
          const allChatbotLinks = document.querySelectorAll("#Chatbot, #Chatbot-mobile");

          featureItems.forEach((item) => {
            const target = item.getAttribute("data-target");
            let targetLinks;
            
            switch(target) {
              case "Profile":
                targetLinks = allProfileLinks;
                break;
              case "Upload":
                targetLinks = allUploadLinks;
                break;
              case "Reports":
                targetLinks = allReportsLinks;
                break;
              case "Insights":
                targetLinks = allInsightsLinks;
                break;
              case "Chatbot":
                targetLinks = allChatbotLinks;
              break;
              default:
                targetLinks = [];
            }

            if (targetLinks.length > 0) {
              item.addEventListener("mouseenter", () => {
                document.body.setAttribute(`data-${target.toLowerCase()}-hover`, "true");
              });

              item.addEventListener("mouseleave", () => {
                document.body.removeAttribute(`data-${target.toLowerCase()}-hover`);
              });

              item.addEventListener("click", () => {
                const href = targetLinks[0]?.getAttribute("href");
                if (href) {
                  window.location.href = href;
                }
              });
            }
          });
        }

        // Update progress bar
        function updateProgress(step) {
          if (progressBar) {
            const progress = (step / totalSteps) * 100;
            progressBar.style.width = `${progress}%`;
          }
        }

        // Find the correct navigation item (desktop or mobile) - UPDATED
        function findNavItem(desktopId, mobileId) {
          const isMobile = window.innerWidth <= 768;
          
          if (isMobile) {
            // For mobile, look for the mobile header navigation items first
            const mobileNavItem = document.getElementById(mobileId);
            if (mobileNavItem) {
              console.log('Found mobile nav item:', mobileId, mobileNavItem);
              return mobileNavItem;
            }
            
            // Fallback to mobile menu if it exists
            const mobileMenu = document.querySelector('.mobile-menu');
            if (mobileMenu && tutorialActive) {
              // Map desktop IDs to mobile menu item positions  
              switch(desktopId) {
                case 'Profile':
                  return mobileMenu.querySelector('.page-link:nth-child(1)');
                case 'Upload':
                  return mobileMenu.querySelector('.page-link:nth-child(2)');
                case 'Reports':
                  return mobileMenu.querySelector('.page-link:nth-child(3)');
                case 'Insights':
                  return mobileMenu.querySelector('.page-link:nth-child(4)');
                case 'Chatbot':
                  return mobileMenu.querySelector('.page-link:nth-child(5)');
                default:
                  return null;
              }
            }
          } else {
            // Desktop - use ID selectors
            return document.getElementById(desktopId) || document.getElementById(mobileId);
          }
          
          return null;
        }

        // Helper function to get mobile menu item index
        function getMobileMenuIndex(itemName) {
          const menuOrder = {
            'Profile': 1,
            'Upload': 2, 
            'Reports': 3,
            'Insights': 4,
            'Chatbot': 5
          };
          return menuOrder[itemName] || 1;
        }

        // Position elements around a target
        function positionElementAroundTarget(element, target, position = "below") {
          if (!element || !target) return;

          const targetRect = target.getBoundingClientRect();
          const isMobile = window.innerWidth <= 768;

          switch (position) {
            case "below":
              element.style.top = `${targetRect.bottom + 10}px`;
              element.style.left = `${targetRect.left + targetRect.width / 2 - 40}px`;
              break;
            case "right":
              if (isMobile) {
                element.style.top = `${targetRect.bottom + 10}px`;
                element.style.left = `${targetRect.left + targetRect.width / 2 - 40}px`;
              } else {
                element.style.left = `${targetRect.right + 10}px`;
                element.style.top = `${targetRect.top + targetRect.height / 2 - 20}px`;
              }
              break;
          }
        }

        // Highlight a navigation item - UPDATED to support blue color
        function highlightNavItem(navItem, highlightEl, color = 'green') {
          if (!navItem || !highlightEl || !tutorialActive) return;

          console.log('Highlighting nav item:', navItem.id || navItem.className, 'with color:', color);

          const rect = navItem.getBoundingClientRect();
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

          // Position relative to document, not viewport
          highlightEl.style.position = 'absolute';
          highlightEl.style.top = `${rect.top + scrollTop - 5}px`;
          highlightEl.style.left = `${rect.left + scrollLeft - 5}px`;
          highlightEl.style.width = `${rect.width + 10}px`;
          highlightEl.style.height = `${rect.height + 10}px`;
          
          // Set color based on type
          if (color === 'blue') {
            highlightEl.style.backgroundColor = 'rgba(63, 177, 241, 0.2)';
            highlightEl.style.borderColor = '#3fb1f1';
          } else {
            // Default green
            highlightEl.style.backgroundColor = 'rgba(92, 177, 93, 0.2)';
            highlightEl.style.borderColor = '#5cb15d';
          }
          
          // Use class-based showing
          highlightEl.classList.add('show');
        }

        // Clear all highlights - UPDATED
        function clearHighlights() {
          console.log('Clearing highlights...');
          
          // Remove show class and hide all highlight elements - UPDATED
          const allHighlights = [
            highlightProfile, highlightUpload, highlightReports, highlightInsights, highlightChatbot,
            highlightInputGroup, highlightOutputGroup
          ];
          
          allHighlights.forEach(highlight => {
            if (highlight) {
              highlight.classList.remove('show');
            }
          });
        }

        // Clear all hover effects - UPDATED
        function clearHoverEffects() {
          // Remove all hover attributes - UPDATED
          const hoverAttributes = [
            "data-profile-hover",
            "data-upload-hover", 
            "data-reports-hover",
            "data-insights-hover",
            "data-chatbot-hover",
            "data-input-group-hover",
            "data-output-group-hover"
          ];
          
          hoverAttributes.forEach(attr => {
            document.body.removeAttribute(attr);
          });
        }

        // Show a specific step - UPDATED
        function showStep(stepNumber) {
          console.log('Showing step:', stepNumber);
          
          // MOBILE ONLY - Ensure mobile menu is open on mobile during tutorial
          if (window.innerWidth <= 768) {
            ensureMobileMenuOpen();
          }
          
          // Hide all steps - UPDATED to include new steps
          if (stepInputOverview) stepInputOverview.style.display = "none";
          if (stepOutputOverview) stepOutputOverview.style.display = "none";
          if (step1) step1.style.display = "none";
          if (step2) step2.style.display = "none";
          if (step3) step3.style.display = "none";
          if (step4) step4.style.display = "none";
          if (step5) step5.style.display = "none";

          // Clear highlights and effects
          clearHighlights();
          clearHoverEffects();

          // Show the current step and highlight appropriate nav items - UPDATED
          switch (stepNumber) {
            case 1:
              if (stepInputOverview) stepInputOverview.style.display = "block";
              // Highlight both Profile and Upload with blue
              const inputNavItems = [
                findNavItem("Profile", "Profile-mobile"),
                findNavItem("Upload", "Upload-mobile")
              ].filter(item => item !== null);
              highlightMultipleNavItems(inputNavItems, highlightInputGroup, 'blue');
              document.body.setAttribute("data-input-group-hover", "true");
              break;
              
            case 2:
              if (stepOutputOverview) stepOutputOverview.style.display = "block";
              // Highlight Reports, Insights, and Chatbot with green
              const outputNavItems = [
                findNavItem("Reports", "Reports-mobile"),
                findNavItem("Insights", "Insights-mobile"),
                findNavItem("Chatbot", "Chatbot-mobile")
              ].filter(item => item !== null);
              highlightMultipleNavItems(outputNavItems, highlightOutputGroup, 'green');
              document.body.setAttribute("data-output-group-hover", "true");
              break;
              
            case 3:
              if (step1) step1.style.display = "block";
              const profileNavItem = findNavItem("Profile", "Profile-mobile");
              highlightNavItem(profileNavItem, highlightProfile, 'blue'); // Changed to blue
              document.body.setAttribute("data-profile-hover", "true");
              break;
              
            case 4:
              if (step2) step2.style.display = "block";
              const uploadNavItem = findNavItem("Upload", "Upload-mobile");
              highlightNavItem(uploadNavItem, highlightUpload, 'blue'); // Changed to blue
              document.body.setAttribute("data-upload-hover", "true");
              break;
              
            case 5:
              if (step3) step3.style.display = "block";
              const reportsNavItem = findNavItem("Reports", "Reports-mobile");
              highlightNavItem(reportsNavItem, highlightReports);
              document.body.setAttribute("data-reports-hover", "true");
              break;
              
            case 6:
              if (step4) step4.style.display = "block";
              const insightsNavItem = findNavItem("Insights", "Insights-mobile");
              highlightNavItem(insightsNavItem, highlightInsights);
              document.body.setAttribute("data-insights-hover", "true");
              break;
              
            case 7:
              if (step5) step5.style.display = "block";
              const chatbotNavItem = findNavItem("Chatbot", "Chatbot-mobile");
              highlightNavItem(chatbotNavItem, highlightChatbot);
              document.body.setAttribute("data-chatbot-hover", "true");
              break;
          }

          currentStep = stepNumber;
          updateProgress(currentStep);
        }

        // Start tutorial
        function startTutorial() {
          console.log('Starting tutorial...');
          tutorialActive = true;
          
          // Add tutorial-active class to body to show arrows/highlights
          document.body.classList.add('tutorial-active');
          
          if (welcomeCard) welcomeCard.style.display = "none";
          if (stepsContainer) stepsContainer.style.display = "block";
          
          // MOBILE ONLY - Open mobile menu if on mobile
          if (window.innerWidth <= 768) {
            ensureMobileMenuOpen();
          }
          
          showStep(1);
        }

        // Complete tutorial
        function completeTutorial() {
          console.log('Tutorial completed, redirecting to profile...');
          window.location.href = '/profile';
        }

        // Function to close mobile menu when tutorial ends
        function closeMobileMenuAfterTutorial() {
          if (window.innerWidth <= 768) {
            const mobileMenu = document.querySelector('.mobile-menu');
            const hamburgerButton = document.getElementById('hamburger-button');
            
            if (mobileMenu && hamburgerButton) {
              hamburgerButton.classList.remove('open');
              mobileMenu.classList.remove('open');
              document.body.classList.remove('menu-open');
              
              // Reset all styles
              mobileMenu.style.position = '';
              mobileMenu.style.zIndex = '';
              mobileMenu.style.maxHeight = '';
              mobileMenu.style.opacity = '';
              mobileMenu.style.visibility = '';
              mobileMenu.style.display = '';
            }
          }
        }

        // Event listeners - UPDATED with new overview buttons
        if (getStartedBtn) {
          getStartedBtn.addEventListener("click", startTutorial);
        }

        const skipTutorialBtn = document.getElementById("skipTutorialBtn");
        if (skipTutorialBtn) {
          skipTutorialBtn.addEventListener("click", completeTutorial);
        }

        // NEW: Event listeners for new overview steps
        if (stepInputOverviewNext) {
          stepInputOverviewNext.addEventListener("click", () => showStep(2));
        }
        if (stepOutputOverviewNext) {
          stepOutputOverviewNext.addEventListener("click", () => showStep(3));
        }

        // UPDATED: Event listeners for existing steps (now steps 3-7)
        if (step1Next) {
          step1Next.addEventListener("click", () => showStep(4));
        }
        if (step2Next) {
          step2Next.addEventListener("click", () => showStep(5));
        }
        if (step3Next) {
          step3Next.addEventListener("click", () => showStep(6));
        }
        if (step4Next) {
          step4Next.addEventListener("click", () => showStep(7));
        }
        if (step5Next) {
          step5Next.addEventListener("click", completeTutorial);
        }

        // Skip buttons
        skipButtons.forEach((button) => {
          button.addEventListener("click", completeTutorial);
        });

        // Navigation click handling - UPDATED for new step numbers
        const allProfileLinks = document.querySelectorAll("#Profile, #Profile-mobile");
        const allUploadLinks = document.querySelectorAll("#Upload, #Upload-mobile");
        const allReportsLinks = document.querySelectorAll("#Reports, #Reports-mobile");
        const allInsightsLinks = document.querySelectorAll("#Insights, #Insights-mobile");
        const allChatbotLinks = document.querySelectorAll("#Chatbot, #Chatbot-mobile");

        allProfileLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 3 && tutorialActive) {  // Changed from 1 to 3
              e.preventDefault();
              showStep(4);  // Changed from 2 to 4
            }
          });
        });

        allUploadLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 4 && tutorialActive) {  // Changed from 2 to 4
              e.preventDefault();
              showStep(5);  // Changed from 3 to 5
            }
          });
        });

        allReportsLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 5 && tutorialActive) {  // Changed from 3 to 5
              e.preventDefault();
              showStep(6);  // Changed from 4 to 6
            }
          });
        });

        allInsightsLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 6 && tutorialActive) {  // Changed from 4 to 6
              e.preventDefault();
              showStep(7);  // Changed from 5 to 7
            }
          });
        });

        allChatbotLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 7 && tutorialActive) {  // Changed from 5 to 7
              e.preventDefault();
              completeTutorial();
            }
          });
        });

        // Initialize hover effects
        initializeFeatureHover();

        // Handle window resize
        window.addEventListener("resize", () => {
          if (currentStep > 0 && tutorialActive) {
            setTimeout(() => {
              showStep(currentStep);
            }, 100);
          }
        });

        // ENSURE ARROWS AND HIGHLIGHTS ARE HIDDEN INITIALLY
        clearHighlights();
        
        console.log('Welcome page script initialized');
      });
    </script>
    <script> // lucide icons
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, attempting to initialize Lucide...');
        console.log('Lucide object:', typeof lucide);
        
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
          console.log('Lucide icons initialized successfully');
        } else {
          console.error('Lucide library not loaded!');
        }
      });
    </script>
  </body>
</html>