<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Welcome</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="css/main-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/user-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/user-header-footer-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/welcome-styles.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="user-body">
    {{> mobileUserHeader}}

    <div class="sidebar">
      <div class="sidebar-logo-wrapper">
        <a href="/" class="sidebar-logo-link">
          <img
            src="images/logo2.png"
            loading="lazy"
            alt="Logo"
            class="sidebar-logo"
        /></a>
      </div>
      <div class="nav-divider-basics nav-divider-top"></div>
      <a id="Profile" href="/profile" class="page-link w-inline-block">
        <img loading="lazy" src="images/user.svg" alt="Icon" class="nav-icon" />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Profile</span>
        </div>
      </a>
      <a id="Upload" href="/upload" class="page-link w-inline-block">
        <img
          src="images/file-text.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Upload</span>
        </div>
      </a>
      <a
        id="Reports"
        href="/reports"
        aria-current="page"
        class="page-link w-inline-block"
        ><img
          src="images/clipboard.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Reports</span>
        </div>
      </a>
      <a id="Insights" href="/insights" class="page-link w-inline-block">
        <img
          src="images/layout.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Insights</span>
        </div>
      </a>
      <div class="nav-divider-basics nav-divider-bottom"></div>
      <a href="/how-it-works" class="page-link w-inline-block"
        ><img
          src="images/help-circle.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Help</span>
        </div>
      </a>
      <a id="Log-out" href="/" class="page-link w-inline-block"
        ><img
          src="images/unlock.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Log out</span>
        </div>
      </a>
      <div class="sidebar-bottom-spacer"></div>
    </div>

    <!-- Highlight elements for navigation arrows -->
    <div class="highlight-nav" id="highlightProfile"></div>
    <div class="highlight-nav" id="highlightUpload"></div>
    <div class="highlight-nav" id="highlightReports"></div>
    <div class="highlight-nav" id="highlightInsights"></div>

    <div class="dashboard-content">
      <!-- Welcome card -->
      <div class="welcome-card" id="welcomeCard">
        <div class="welcome-header">
          <h1 class="welcome-title">Welcome to HealthLync!</h1>
          <p class="welcome-subtitle">
            Your personalized health management platform.
          </p>
          <button class="get-started-btn" id="getStartedBtn">
            Get Started
          </button>
        </div>

        <div class="feature-overview">
          <div class="feature-item" data-target="Profile">
            <div class="feature-icon">ðŸ“‹</div>
            <div class="feature-title">Profile</div>
            <div class="feature-description">
              Add your personal health details and medical history
            </div>
          </div>
          <div class="feature-item" data-target="Upload">
            <div class="feature-icon">ðŸ“„</div>
            <div class="feature-title">Upload</div>
            <div class="feature-description">
              Upload your medical records and lab results
            </div>
          </div>
          <div class="feature-item" data-target="Reports">
            <div class="feature-icon">ðŸ“Š</div>
            <div class="feature-title">Reports</div>
            <div class="feature-description">
              View detailed reports based on your health data
            </div>
          </div>
          <div class="feature-item" data-target="Insights">
            <div class="feature-icon">ðŸ’¡</div>
            <div class="feature-title">Insights</div>
            <div class="feature-description">
              Get personalized insights and recommendations
            </div>
          </div>
        </div>
      </div>

      <!-- Interactive steps -->
      <div class="steps-container2">
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Step 1 -->
        <div class="step-container" id="step1">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">1</span>
              Set up your profile
            </div>
            <div class="step-description">
              Start by completing your profile. This helps us personalize your
              experience and provide more accurate insights.
              <div class="highlight">
                Navigate to the <strong>Profile</strong> page to add your
                personal information, family medical history, and lifestyle
                details.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step1Next">Next</button>
              <button class="button-skip" id="skipTutorial">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="step-container" id="step2">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">2</span>
              Upload your health data
            </div>
            <div class="step-description">
              Upload your lab results and medical documents to build your health
              profile.
              <div class="highlight">
                Visit the <strong>Upload</strong> page to add your lab reports,
                medical records, and other health documents. We'll automatically
                extract key information.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step2Next">Next</button>
              <button class="button-skip" id="skipTutorial2">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="step-container" id="step3">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">3</span>
              View your health reports
            </div>
            <div class="step-description">
              After uploading your data, view comprehensive reports about your
              health metrics.
              <div class="highlight">
                Check the <strong>Reports</strong> page to see detailed analysis
                of your biomarkers, trends over time, and comparisons to
                reference ranges.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step3Next">Next</button>
              <button class="button-skip" id="skipTutorial3">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>

        <!-- Step 4 -->
        <div class="step-container" id="step4">
          <div class="step-content">
            <div class="step-title">
              <span class="welcome-step-number">4</span>
              Gain personalized insights
            </div>
            <div class="step-description">
              Discover personalized health insights and recommendations based on
              your data.
              <div class="highlight">
                Visit the <strong>Insights</strong> page to receive customized
                health recommendations and actionable steps to improve your
                wellbeing.
              </div>
            </div>
            <div class="actions">
              <button class="button-next" id="step4Next">Let's Start!</button>
              <button class="button-skip" id="skipTutorial4">
                Skip Tutorial
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/main-user.js" defer type="module"></script>
    <script> // Welcome animations
      document.addEventListener("DOMContentLoaded", () => {
        console.log('Welcome page script loading...');
        
        // TUTORIAL FUNCTIONALITY
        const getStartedBtn = document.getElementById("getStartedBtn");
        const welcomeCard = document.getElementById("welcomeCard");
        const stepsContainer = document.querySelector(".steps-container2");
        const progressBar = document.getElementById("progressBar");
        const skipButtons = document.querySelectorAll(".button-skip");

        // Navigation elements - check for both desktop and mobile versions
        const profileLink = document.getElementById("Profile") || document.getElementById("Profile-mobile");
        const uploadLink = document.getElementById("Upload") || document.getElementById("Upload-mobile");
        const reportsLink = document.getElementById("Reports") || document.getElementById("Reports-mobile");
        const insightsLink = document.getElementById("Insights") || document.getElementById("Insights-mobile");

        // Highlight elements
        const highlightProfile = document.getElementById("highlightProfile");
        const highlightUpload = document.getElementById("highlightUpload");
        const highlightReports = document.getElementById("highlightReports");
        const highlightInsights = document.getElementById("highlightInsights");

        // Arrow elements
        const arrowToProfile = document.getElementById("arrowToProfile");
        const arrowToUpload = document.getElementById("arrowToUpload");
        const arrowToReports = document.getElementById("arrowToReports");
        const arrowToInsights = document.getElementById("arrowToInsights");

        // Step elements
        const step1 = document.getElementById("step1");
        const step2 = document.getElementById("step2");
        const step3 = document.getElementById("step3");
        const step4 = document.getElementById("step4");

        // Next buttons
        const step1Next = document.getElementById("step1Next");
        const step2Next = document.getElementById("step2Next");
        const step3Next = document.getElementById("step3Next");
        const step4Next = document.getElementById("step4Next");

        // Current step tracker
        let currentStep = 0;
        const totalSteps = 4;
        let tutorialActive = false;

        console.log('Tutorial elements found:', {
          getStartedBtn: !!getStartedBtn,
          welcomeCard: !!welcomeCard,
          stepsContainer: !!stepsContainer,
          profileLink: !!profileLink,
          highlightProfile: !!highlightProfile,
          arrowToProfile: !!arrowToProfile
        });

        function ensureMobileMenuOpen() {
          // MOBILE ONLY - no desktop impact
          if (window.innerWidth <= 768 && tutorialActive) {
            const mobileMenu = document.querySelector('.mobile-menu');
            const hamburgerButton = document.getElementById('hamburger-button');
            
            if (mobileMenu && hamburgerButton && !mobileMenu.classList.contains('open')) {
              // Open the mobile menu for tutorial
              hamburgerButton.classList.add('open');
              mobileMenu.classList.add('open');
              
              // Don't push content down during tutorial
              document.body.classList.remove('menu-open');
              
              // Keep menu open during tutorial
              mobileMenu.style.position = 'absolute';
              mobileMenu.style.zIndex = '1600'; // Above tutorial elements
            }
          }
        }

        // Initialize features hover synchronization
        function initializeFeatureHover() {
          const featureItems = document.querySelectorAll(".feature-item");
          
          // Get all navigation links (both desktop and mobile)
          const allProfileLinks = document.querySelectorAll("#Profile, #Profile-mobile");
          const allUploadLinks = document.querySelectorAll("#Upload, #Upload-mobile");
          const allReportsLinks = document.querySelectorAll("#Reports, #Reports-mobile");
          const allInsightsLinks = document.querySelectorAll("#Insights, #Insights-mobile");

          featureItems.forEach((item) => {
            const target = item.getAttribute("data-target");
            let targetLinks;
            
            switch(target) {
              case "Profile":
                targetLinks = allProfileLinks;
                break;
              case "Upload":
                targetLinks = allUploadLinks;
                break;
              case "Reports":
                targetLinks = allReportsLinks;
                break;
              case "Insights":
                targetLinks = allInsightsLinks;
                break;
              default:
                targetLinks = [];
            }

            if (targetLinks.length > 0) {
              item.addEventListener("mouseenter", () => {
                document.body.setAttribute(`data-${target.toLowerCase()}-hover`, "true");
              });

              item.addEventListener("mouseleave", () => {
                document.body.removeAttribute(`data-${target.toLowerCase()}-hover`);
              });

              item.addEventListener("click", () => {
                const href = targetLinks[0]?.getAttribute("href");
                if (href) {
                  window.location.href = href;
                }
              });
            }
          });
        }

        // Update progress bar
        function updateProgress(step) {
          if (progressBar) {
            const progress = (step / totalSteps) * 100;
            progressBar.style.width = `${progress}%`;
          }
        }

        // Find the correct navigation item (desktop or mobile)
        function findNavItem(desktopId, mobileId) {
          const isMobile = window.innerWidth <= 768;
          
          // MOBILE ONLY CHANGES - desktop uses original logic unchanged
          if (isMobile && tutorialActive) {
            // During mobile tutorial, always use mobile menu items
            const mobileItem = document.querySelector(`.mobile-menu .page-link:nth-child(${getMobileMenuIndex(desktopId)})`);
            if (mobileItem) return mobileItem;
          }
          
          // ORIGINAL DESKTOP LOGIC UNCHANGED
          const desktopItem = document.getElementById(desktopId);
          const mobileItem = document.getElementById(mobileId);
          
          if (isMobile) {
            return mobileItem || desktopItem;
          } else {
            return desktopItem || mobileItem;
          }
        }

        // Helper function to get mobile menu item index
        function getMobileMenuIndex(itemName) {
          const menuOrder = {
            'Profile': 1,
            'Upload': 2, 
            'Reports': 3,
            'Insights': 4
          };
          return menuOrder[itemName] || 1;
        }

        // Position elements around a target
        function positionElementAroundTarget(element, target, position = "below") {
          if (!element || !target) return;

          const targetRect = target.getBoundingClientRect();
          const isMobile = window.innerWidth <= 768;

          switch (position) {
            case "below":
              element.style.top = `${targetRect.bottom + 10}px`;
              element.style.left = `${targetRect.left + targetRect.width / 2 - 40}px`;
              break;
            case "right":
              if (isMobile) {
                element.style.top = `${targetRect.bottom + 10}px`;
                element.style.left = `${targetRect.left + targetRect.width / 2 - 40}px`;
              } else {
                element.style.left = `${targetRect.right + 10}px`;
                element.style.top = `${targetRect.top + targetRect.height / 2 - 20}px`;
              }
              break;
          }
        }

        // Highlight a navigation item
        function highlightNavItem(navItem, highlightEl, arrowEl) {
          if (!navItem || !highlightEl || !tutorialActive) return;

          console.log('Highlighting nav item:', navItem.id || navItem.className);

          const rect = navItem.getBoundingClientRect();

          highlightEl.style.top = `${rect.top - 5}px`;
          highlightEl.style.left = `${rect.left - 5}px`;
          highlightEl.style.width = `${rect.width + 10}px`;
          highlightEl.style.height = `${rect.height + 10}px`;
          highlightEl.style.display = "block";

          if (arrowEl) {
            positionElementAroundTarget(arrowEl, navItem, "right");
            arrowEl.style.display = "block";
          }
        }

        // Clear all highlights
        function clearHighlights() {
          console.log('Clearing highlights...');
          
          if (highlightProfile) highlightProfile.style.display = "none";
          if (highlightUpload) highlightUpload.style.display = "none";
          if (highlightReports) highlightReports.style.display = "none";
          if (highlightInsights) highlightInsights.style.display = "none";

          if (arrowToProfile) arrowToProfile.style.display = "none";
          if (arrowToUpload) arrowToUpload.style.display = "none";
          if (arrowToReports) arrowToReports.style.display = "none";
          if (arrowToInsights) arrowToInsights.style.display = "none";
        }

        // Clear all hover effects
        function clearHoverEffects() {
          document.body.removeAttribute("data-profile-hover");
          document.body.removeAttribute("data-upload-hover");
          document.body.removeAttribute("data-reports-hover");
          document.body.removeAttribute("data-insights-hover");
        }

        // Show a specific step
        function showStep(stepNumber) {
          console.log('Showing step:', stepNumber);
          
          // MOBILE ONLY - Ensure mobile menu is open on mobile during tutorial
          if (window.innerWidth <= 768) {
            ensureMobileMenuOpen();
          }
          
          // EXISTING LOGIC UNCHANGED - works for both desktop and mobile
          // Hide all steps
          if (step1) step1.style.display = "none";
          if (step2) step2.style.display = "none";
          if (step3) step3.style.display = "none";
          if (step4) step4.style.display = "none";

          // Clear highlights and effects
          clearHighlights();
          clearHoverEffects();

          // Show the current step and highlight appropriate nav item
          switch (stepNumber) {
            case 1:
              if (step1) step1.style.display = "block";
              const profileNavItem = findNavItem("Profile", "Profile-mobile");
              highlightNavItem(profileNavItem, highlightProfile);
              document.body.setAttribute("data-profile-hover", "true");
              break;
            case 2:
              if (step2) step2.style.display = "block";
              const uploadNavItem = findNavItem("Upload", "Upload-mobile");
              highlightNavItem(uploadNavItem, highlightUpload);
              document.body.setAttribute("data-upload-hover", "true");
              break;
            case 3:
              if (step3) step3.style.display = "block";
              const reportsNavItem = findNavItem("Reports", "Reports-mobile");
              highlightNavItem(reportsNavItem, highlightReports);
              document.body.setAttribute("data-reports-hover", "true");
              break;
            case 4:
              if (step4) step4.style.display = "block";
              const insightsNavItem = findNavItem("Insights", "Insights-mobile");
              highlightNavItem(insightsNavItem, highlightInsights);
              document.body.setAttribute("data-insights-hover", "true");
              break;
          }

          currentStep = stepNumber;
          updateProgress(currentStep);
        }

        // Start tutorial
        function startTutorial() {
          console.log('Starting tutorial...');
          tutorialActive = true;
          
          // Add tutorial-active class to body to show arrows/highlights
          document.body.classList.add('tutorial-active');
          
          if (welcomeCard) welcomeCard.style.display = "none";
          if (stepsContainer) stepsContainer.style.display = "block";
          
          // MOBILE ONLY - Open mobile menu if on mobile
          if (window.innerWidth <= 768) {
            ensureMobileMenuOpen();
          }
          
          showStep(1);
        }

        // Complete tutorial
        function completeTutorial() {
          console.log('Completing tutorial...');
          tutorialActive = false;
          
          // Remove tutorial-active class to hide arrows/highlights
          document.body.classList.remove('tutorial-active');
          
          if (stepsContainer) stepsContainer.style.display = "none";
          clearHighlights();
          clearHoverEffects();
          
          // MOBILE ONLY - Close mobile menu after tutorial
          if (window.innerWidth <= 768) {
            closeMobileMenuAfterTutorial();
          }

          // Redirect to profile page
          window.location.href = "/profile";
        }

        // Function to close mobile menu when tutorial ends
        function closeMobileMenuAfterTutorial() {
          // MOBILE ONLY - no desktop impact
          if (window.innerWidth <= 768) {
            const mobileMenu = document.querySelector('.mobile-menu');
            const hamburgerButton = document.getElementById('hamburger-button');
            
            if (mobileMenu && hamburgerButton) {
              hamburgerButton.classList.remove('open');
              mobileMenu.classList.remove('open');
              document.body.classList.remove('menu-open');
              
              // Reset menu styles
              mobileMenu.style.position = '';
              mobileMenu.style.zIndex = '';
            }
          }
        }

        // Event listeners
        if (getStartedBtn) {
          getStartedBtn.addEventListener("click", startTutorial);
        }

        if (step1Next) {
          step1Next.addEventListener("click", () => showStep(2));
        }
        if (step2Next) {
          step2Next.addEventListener("click", () => showStep(3));
        }
        if (step3Next) {
          step3Next.addEventListener("click", () => showStep(4));
        }
        if (step4Next) {
          step4Next.addEventListener("click", completeTutorial);
        }

        // Skip buttons
        skipButtons.forEach((button) => {
          button.addEventListener("click", completeTutorial);
        });

        // Navigation click handling
        const allProfileLinks = document.querySelectorAll("#Profile, #Profile-mobile");
        const allUploadLinks = document.querySelectorAll("#Upload, #Upload-mobile");
        const allReportsLinks = document.querySelectorAll("#Reports, #Reports-mobile");
        const allInsightsLinks = document.querySelectorAll("#Insights, #Insights-mobile");

        allProfileLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 1 && tutorialActive) {
              e.preventDefault();
              showStep(2);
            }
          });
        });

        allUploadLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 2 && tutorialActive) {
              e.preventDefault();
              showStep(3);
            }
          });
        });

        allReportsLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 3 && tutorialActive) {
              e.preventDefault();
              showStep(4);
            }
          });
        });

        allInsightsLinks.forEach(link => {
          link.addEventListener("click", (e) => {
            if (currentStep === 4 && tutorialActive) {
              e.preventDefault();
              completeTutorial();
            }
          });
        });

        // Initialize hover effects
        initializeFeatureHover();

        // Handle window resize
        window.addEventListener("resize", () => {
          if (currentStep > 0 && tutorialActive) {
            setTimeout(() => {
              showStep(currentStep);
            }, 100);
          }
        });

        // ENSURE ARROWS AND HIGHLIGHTS ARE HIDDEN INITIALLY
        clearHighlights();
        
        console.log('Welcome page script initialized');
      });
    </script>

  </body>
</html>
