<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Chatbot</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="css/main-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/user-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/user-header-footer-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/insights-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/chatbot-styles.css" rel="stylesheet" type="text/css" />
    <link href="css/chatbot-modern.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="user-body">
    {{> mobileUserHeader currentPage="chatbot"}}

    <!-- Main Navigation Sidebar (Unchanged) -->
    <div class="sidebar">
      <div class="sidebar-logo-wrapper">
        <div class="sidebar-logo-link">
          <img
            src="images/logo2.png"
            loading="lazy"
            alt="Logo"
            class="sidebar-logo"
        /></div>
      </div>
      <div class="nav-divider-basics nav-divider-top"></div>
      <a id="Profile" href="/profile" class="page-link w-inline-block">
        <img loading="lazy" src="images/user.svg" alt="Icon" class="nav-icon" />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Profile</span>
        </div>
      </a>
      <a id="Upload" href="/upload" class="page-link w-inline-block">
        <img
          src="images/file-text.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Upload</span>
        </div>
      </a>
      <a
        id="Reports"
        href="/reports"
        aria-current="page"
        class="page-link w-inline-block"
        ><img
          src="images/clipboard.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Reports</span>
        </div>
      </a>
      <a
        id="Insights"
        href="/insights"
        class="page-link w-inline-block"
      >
        <img
          src="images/layout.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Insights</span>
        </div>
      </a>
      <a
        id="Chatbot"
        href="/chatbot"
        class="page-link w-inline-block w--current"
      >
        <img
          src="images/chatbot.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Ask</span>
        </div>
      </a>
      <div class="nav-divider-basics nav-divider-bottom"></div>
      <a id="Log-out" href="/logout" class="page-link w-inline-block" onclick="return confirmLogout(event)">
        <img
          src="images/unlock.svg"
          loading="lazy"
          alt="Icon"
          class="nav-icon"
        />
        <div class="page-link-text-block">
          <span class="page-link-text-span">Log out</span>
        </div>
      </a>
      <div class="sidebar-bottom-spacer"></div>
    </div>

    <!-- Modern Chat Layout -->
    <div class="modern-chat-layout">
      <!-- Conversation History Sidebar -->
      <div class="conversation-sidebar">
        <div class="conversation-sidebar-header">
          <h3 class="conversation-sidebar-title">Your chat history</h3>
          <button 
            id="new-conversation-btn" 
            class="new-conversation-btn"
            title="New conversation"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>New chat</span>
          </button>
        </div>

        <div class="conversation-search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            id="conversation-search-input" 
            placeholder="Search your chats..."
            class="conversation-search-input"
          />
        </div>

        <div class="conversation-list-container">
          <div id="conversation-list" class="conversation-list">
            <!-- Conversations will be loaded here -->
            <div class="conversation-list-loading">
              <div class="loading-spinner"></div>
              <p>Loading conversations...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Chat Area -->
      <div class="chat-main-area">
        <section class="demo-header chat-header-modern">
          <div class="header-container-2">
            {{!-- <div class="header-title-group" style="display: none;">
              <h2 class="heading2">Chatbot</h2>
              <span id="current-conversation-title" class="conversation-subtitle"></span>
            </div> --}}
            
            <!-- Ask Tab Notification - Hidden by default -->
            <div id="askTabNotification" class="ask-tab-notification" style="display: none;">
              <div class="notification-container">
                <div class="notification-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                  </svg>
                </div>
                <div class="notification-content">
                  <div class="notification-title">Reed is a work in progress</div>
                  <div class="notification-message">
                    Our AI health assistant is currently being trained and our database is small. We plan to improve Reed's knowledge base soon!
                  </div>
                </div>
                <button class="notification-close" aria-label="Close notification">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </section>

        <div class="dashboard-content modern-dashboard">
          <div class="dashboard-container">
            <div class="modern-chat-container">
              <!-- Welcome State (shown when no conversation is active) -->
              <div id="welcome-state" class="welcome-state">
                <div class="welcome-content">
                  <h2 class="welcome-title">Hello, <span id="welcome-user-name">there</span></h2>
                  <p class="welcome-subtitle">
                    I can answer questions about cardiovascular health, cholesterol, exercise, and other health topics. How can I help you today?
                  </p>
                  
                  <!-- Welcome Input Box -->
                  <div class="welcome-input-container">
                    <input 
                      type="text" 
                      id="welcome-input" 
                      class="welcome-input" 
                      placeholder="Ask me anything..."
                    />
                    <button id="welcome-submit" class="welcome-submit-btn">
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                      </svg>
                    </button>
                  </div>

                  <div class="welcome-suggestions">
                    <button class="suggestion-btn" data-query="What is my latest cholesterol level?">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                      </svg>
                      What is my latest cholesterol level?
                    </button>
                    <button class="suggestion-btn" data-query="What are the leading causes of mortality?">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                      </svg>
                      What are the leading causes of mortality?
                    </button>
                    <button class="suggestion-btn" data-query="How can I improve my cardiovascular health?">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                      </svg>
                      How can I improve my cardiovascular health?
                    </button>
                  </div>
                </div>
              </div>

              <!-- Chat Interface -->
              <div id="chat-interface" class="chat-interface" style="display: none;">
                <div class="chat-messages-wrapper">
                  <div id="chat-messages" class="chat-messages-modern">
                    <!-- Messages will appear here -->
                  </div>
                </div>

                <!-- Input Area -->
                <div class="chat-input-wrapper">
                  <div class="chat-input-container-modern">
                    <textarea
                      id="chat-input"
                      class="chat-input-modern"
                      placeholder="Ask me about health topics..."
                      rows="1"
                    ></textarea>
                    <div class="chat-input-actions">
                      <button 
                        id="clear-conversation-btn" 
                        class="chat-action-btn"
                        title="Clear conversation"
                      >
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="1 4 1 10 7 10"></polyline>
                          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                      </button>
                      <button 
                        class="chat-action-btn info-button" 
                        title="About Reed"
                      >
                        {{> svg/info}}
                      </button>
                      <button id="chat-submit" class="chat-submit-btn-modern">
                        <svg
                          width="20"
                          height="20"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <line x1="22" y1="2" x2="11" y2="13"></line>
                          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="background report-background">
      <div class="w-layout-blockcontainer container-4 w-container"></div>
    </section>

    <!-- Scripts (Unchanged) -->
    <script
      src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6606de22e8c152e6b19be98a"
      type="text/javascript"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script src="js/main.js" type="text/javascript"></script>
    <script src="js/main-user.js" defer type="module"></script>
    <script src="js/wellnessScore.js" type="text/javascript"></script>
    <script src="js/mobile-logout.js"></script>
    <script src="js/sidebar-logout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Main Chat Functionality Script -->
    <script src="js/chatbot-modern.js"></script>

    <!-- Notification Script -->
    <script>
      (function() {
        'use strict';
        
        function initNotification() {
          try {
            const askTabNotification = document.getElementById('askTabNotification');
            const closeButton = document.querySelector('.notification-close');
            
            if (!askTabNotification) return;
            
            const notificationDismissed = localStorage.getItem('askTabNotificationDismissed');
            
            function showNotification() {
              if (notificationDismissed) return;
              
              askTabNotification.style.display = 'block';
              askTabNotification.style.opacity = '0';
              askTabNotification.style.transform = 'translateY(-10px)';
              askTabNotification.style.transition = 'all 0.3s ease';
              
              setTimeout(() => {
                askTabNotification.style.opacity = '1';
                askTabNotification.style.transform = 'translateY(0)';
              }, 50);
            }
            
            function hideNotification() {
              askTabNotification.style.opacity = '0';
              askTabNotification.style.transform = 'translateY(-10px)';
              
              setTimeout(() => {
                askTabNotification.style.display = 'none';
              }, 300);
            }
            
            function dismissNotification() {
              hideNotification();
              localStorage.setItem('askTabNotificationDismissed', 'true');
            }
            
            if (closeButton) {
              closeButton.addEventListener('click', dismissNotification);
            }
            
            // Show notification on load
            setTimeout(showNotification, 500);
            
          } catch (error) {
            console.error('Notification script error:', error);
          }
        }
        
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initNotification);
        } else {
          initNotification();
        }
        
      })();
    </script>
  </body>
</html>
